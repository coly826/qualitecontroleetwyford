<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Dashboard QC</title>

<!-- Bootstrap -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- AOS Animation -->
<link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">

<style>
/* ===== TABLE RESPONSIVE ===== */
.table-responsive {
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

table th, table td {
  white-space: nowrap;
  font-size: 14px;
}

/* ===== NAVBAR ===== */
.navbar {
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.navbar-brand {
  font-weight: bold;
}

/* ===== BUTTON ANIMATION ===== */
.btn {
  transition: all 0.3s ease-in-out;
}

.btn:hover {
  transform: scale(1.05);
}

/* ===== ROW HOVER ===== */
tbody tr {
  transition: all 0.3s ease;
}

tbody tr:hover {
  background-color: #e9f2ff;
  transform: scale(1.01);
}

/* ===== MOBILE ADAPTATION ===== */
@media (max-width: 992px) {
  table th, table td {
    font-size: 12px;
  }
}

/* ===== PRINT MODE ===== */
@media print {
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
    color-adjust: exact !important;
  }

  body {
    background: #ffffff !important;
  }

  .navbar, .btn, form {
    display: none !important;
  }

  .badge {
    color: #fff !important;
    border-radius: 4px !important;
    padding: 4px 6px !important;
  }

  .table-primary {
    background-color: #cfe2ff !important;
  }
  .table-success {
    background-color: #d1e7dd !important;
  }
  .bg-secondary {
    background-color: #6c757d !important;
    color: #fff !important;
  }
  .bg-primary {
    background-color: #0d6efd !important;
    color: #fff !important;
  }
}
</style>
</head>

<body class="bg-light pt-5">

<!-- ===== NAVBAR ===== -->
<nav class="navbar navbar-dark bg-primary fixed-top" data-aos="fade-down">
  <div class="container-fluid d-flex justify-content-between">
    <span class="navbar-brand">QC DASHBOARD</span>
    <div class="d-flex gap-2">
      <a href="/form" class="btn btn-light">âž• Ajouter</a>
      <a href="/rapport" class="btn btn-success">ðŸ“Š Rapport</a>
      <button onclick="window.print()" class="btn btn-warning">ðŸ–¨ Imprimer</button>
    </div>
  </div>
</nav>

<!-- ===== CONTENT ===== -->
<div class="container-fluid mt-4">
  <div class="table-responsive" data-aos="zoom-in">
    <table class="table table-bordered table-striped table-hover text-center align-middle">
      <thead class="table-primary">
        <tr>
          <th>Date</th>
          <th>Groupe</th>
          <th>K</th>
          <th>Ligne</th>
          <th>T1</th>
          <th>T2</th>
          <th>T3</th>
          <th>Cartons</th>
          <th>PiÃ¨ces</th>
          <th>Ã‰tiquettes</th>
          <th>Edge</th>
          <th>Surface</th>
          <th>Broken</th>
          <th>% DÃ©fauts</th>
          <th>Action</th>
        </tr>
      </thead>

      <tbody>
        <% data.forEach(d => { 
          const cartons = Number(d.cartons) || 0;
          const pieces = Number(d.pieces) || 0;
          const etiquettes = Number(d.etiquettes) || 0;
          const edge = Number(d.edge) || 0;
          const surface = Number(d.surface) || 0;
          const broken = Number(d.broken) || 0;

          const totalDefauts = pieces + etiquettes + edge + surface + broken;
          const pourcentage = cartons > 0 ? (totalDefauts / cartons) * 100 : 0;
        %>

        <tr data-aos="fade-up">
          <td><%= d.date %></td>
          <td><%= d.groupe %></td>
          <td><%= d.k_option %></td>
          <td><%= d.ligne %></td>
          <td><%= d.table_t1 %></td>
          <td><%= d.table_t2 %></td>
          <td><%= d.table_t3 %></td>
          <td><%= cartons %></td>
          <td><%= pieces %></td>
          <td><%= etiquettes %></td>
          <td><%= edge %></td>
          <td><%= surface %></td>
          <td><%= broken %></td>

          <!-- POURCENTAGE -->
          <td>
            <span class="badge <%= pourcentage < 3 ? 'bg-success' : 'bg-danger' %>">
              <%= pourcentage.toFixed(2) %> %
            </span>
          </td>

          <td>
            <form action="/delete/<%= d._id %>" method="POST">
              <button type="submit" class="btn btn-danger btn-sm"
                onclick="return confirm('Supprimer cette ligne ?');">
                ðŸ—‘
              </button>
            </form>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<!-- AOS -->
<script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
<script>
AOS.init({
  once: true,
  duration: 700,
  easing: 'ease-in-out'
});
</script>

</body>
</html>
